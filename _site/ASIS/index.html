<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
    <meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1">
    <meta name=viewport content="width=device-width, initial-scale=1">
    <title>ASIS 2022 &#8211; c4tbu1</title>
    <meta name="description" content="Simple Jekyll theme for your blog by Taylan Tatlı.">
    <meta name="keywords" content="jekyll, ramme, blog, about, theme">
    <link rel="canonical" href="http://localhost:4000/ASIS/">
        <!-- Twitter Cards -->
    <meta name="twitter:title" content="ASIS 2022">
    <meta name="twitter:description" content="Simple Jekyll theme for your blog by Taylan Tatlı.">
    
    <meta name="twitter:card" content="summary">
    <meta name="twitter:image" content="http://localhost:4000/assets/img/Logo.png">
    <!-- Open Graph -->
    <meta property="og:locale" content="en_US">
    <meta property="og:type" content="article">
    <meta property="og:title" content="ASIS 2022">
    <meta property="og:description" content="Simple Jekyll theme for your blog by Taylan Tatlı.">
    <meta property="og:url" content="http://localhost:4000/ASIS/">
    <meta property="og:site_name" content="c4tbu1">
    <meta property="og:image" content="http://localhost:4000/assets/img/Logo.png">

    
    
    <!-- Handheld -->
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Favicons -->
    <link rel="apple-touch-icon-precomposed" sizes="57x57" href="http://localhost:4000/assets/img/favicon/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://localhost:4000/assets/img/favicon/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://localhost:4000/assets/img/favicon/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://localhost:4000/assets/img/favicon/apple-touch-icon-144x144.png">
    <link rel="icon" type="image/png" href="http://localhost:4000/assets/img/favicon/favicon.png">
    <link rel="shortcut icon" href="http://localhost:4000/assets/img/favicon/favicon.ico">
    <!-- Feed -->
    <link rel="alternate" type="application/rss+xml" title="c4tbu1" href="http://localhost:4000/feed.xml" />
    <!-- CSS -->
    <link rel="stylesheet" type="text/css" href="http://localhost:4000/assets/css/main.css">
</head>


<body>
        <nav class="nav">
        <ul class="list">
            
				    
				    <li class="item"><a class="link" href="http://localhost:4000/" >Home</a></li>
				
				    
				    <li class="item"><a class="link" href="http://localhost:4000/blog/" >Blog</a></li>
				
				    
				    <li class="item"><a class="link" href="http://localhost:4000/projects/" >Projects</a></li>
				
				    
				    <li class="item"><a class="link" href="http://localhost:4000/about/" >About</a></li>
				
        </ul>
    </nav>

    <div class="wrapper">
        <div class="title">
            <h1>ASIS 2022</h1>
            <h4>28 Nov 2022</h4>
        </div>
        <div class="article">
            <section id="table-of-contents" class="toc">
  <header>
    <h3><i class="fa fa-book"></i> Contents</h3>
  </header>
<div id="drawer">
<ul id="markdown-toc">
  <li><a href="#figole---rev" id="markdown-toc-figole---rev">Figole - rev</a>    <ul>
      <li><a href="#description" id="markdown-toc-description">Description</a></li>
    </ul>
  </li>
  <li><a href="#chaffymasking---crypto" id="markdown-toc-chaffymasking---crypto">Chaffymasking - Crypto</a></li>
  <li><a href="#description-1" id="markdown-toc-description-1">Description</a></li>
</ul>

  </div>
</section>
<!-- /#table-of-contents -->

<h2 id="figole---rev">Figole - rev</h2>
<h3 id="description">Description</h3>
<blockquote>
  <p>This recipe for <a href="https://asisctf.com/tasks/figole.apk_2b2eb4b66298cf8b30bf75115796d26fc10bcf27.txz">Figole</a>, by ASIS, is from APK is a Full Android, one of the codebooks created in Android. We’ll help you start your own personal codebook! It’s easy and fun.</p>
</blockquote>

<blockquote>
  <p>Trong lúc làm bài này không hiểu sao mình bị thao túng tâm lí :))), bị nó lừa nên là mất thời gian khá nhiều mới có thể fix. Ah mình ngu quá…</p>
</blockquote>

<p>Đề cho mình 1 file apk, thử mở bằng jadx
<img src="https://i.imgur.com/Sa4RrtX.png" alt="" /></p>

<p>Đầu tiên mình chỉ xem mỗi class MainActivity mình nghĩ nó là luồng thực thi chính của chương trình, nhưng không…</p>

<p><img src="https://i.imgur.com/inj3BLJ.png" alt="" /></p>

<p>Lúc mình chưa nhận ra mình làm sai chổ nào mà không ra flag thì xem lại mainfest mới biết là DActivity mới là luồng thực thi chính. Đấy mình bị lừa chổ này thôi, phần còn lại của bài rev khác là dễ.</p>

<p><img src="https://i.imgur.com/t17VruY.png" alt="" /></p>

<p>Đối với bài này không cần cài đặt mà chúng ta chỉ cần chú ý vào hàm main, có thể thấy đây là một bài check flag bình thường.</p>

<p><img src="https://i.imgur.com/FQFW5Cj.png" alt="" /></p>

<p>Đầu tiên nó lấy và 2 chuỗi <code class="language-plaintext highlighter-rouge">q</code> và <code class="language-plaintext highlighter-rouge">y</code>, sau đó input text của mình sẽ được đem xử lí cùng <code class="language-plaintext highlighter-rouge">q</code> và so sánh với <code class="language-plaintext highlighter-rouge">y</code>.</p>

<p><code class="language-plaintext highlighter-rouge">q</code> và <code class="language-plaintext highlighter-rouge">y</code> lần lượt lấy từ <code class="language-plaintext highlighter-rouge">l2()</code> và <code class="language-plaintext highlighter-rouge">l1()</code></p>

<p><img src="https://i.imgur.com/B7jMMvf.png" alt="" /></p>

<p>Về <code class="language-plaintext highlighter-rouge">l1()</code> có thể thấy nó gọi 1 method khác có tên là <code class="language-plaintext highlighter-rouge">gf()</code></p>

<p><img src="https://i.imgur.com/xRPyKTR.png" alt="" /></p>

<p><code class="language-plaintext highlighter-rouge">gf()</code> sẽ gọi <code class="language-plaintext highlighter-rouge">gd()</code>, có thể thấy nó lấy chuỗi đầu tiên từ database tên calibri.
<img src="https://i.imgur.com/qNbJK6D.png" alt="" />
<img src="https://i.imgur.com/qM7CObh.png" alt="" /></p>

<p>Tìm file <code class="language-plaintext highlighter-rouge">calibri.ttf</code>, đổi đuôi file thành <code class="language-plaintext highlighter-rouge">.db</code> và mở bằng SQLite ta có 2 chuỗi như sau:</p>

<p><img src="https://i.imgur.com/8DlD8vd.png" alt="" /></p>

<p>Ta có base64 sẽ là <code class="language-plaintext highlighter-rouge">y</code> và tương tự với <code class="language-plaintext highlighter-rouge">l2()</code>, chuỗi còn lại sẽ là <code class="language-plaintext highlighter-rouge">q</code></p>

<p>Trước khi gọi<code class="language-plaintext highlighter-rouge">l3()</code>, q được xử lí qua <code class="language-plaintext highlighter-rouge">cdec()</code>, <code class="language-plaintext highlighter-rouge">cdec()</code> chỉ là xor <code class="language-plaintext highlighter-rouge">q</code> với “key”.</p>

<p><img src="https://i.imgur.com/IJaT54x.png" alt="" /></p>

<p><img src="https://i.imgur.com/AzIwJhu.png" alt="" /></p>

<p>Còn về <code class="language-plaintext highlighter-rouge">l3()</code> sẽ gọi method có tên là <code class="language-plaintext highlighter-rouge">ech()</code></p>

<p><img src="https://i.imgur.com/HC04O3n.png" alt="" /></p>

<p><img src="https://i.imgur.com/9wjoBeZ.png" alt="" /></p>

<p><code class="language-plaintext highlighter-rouge">ech()</code> sẽ cộng <code class="language-plaintext highlighter-rouge">q</code> với 1 chuỗi sau khi được decode bằng base64, và xử lí bằng <code class="language-plaintext highlighter-rouge">getK()</code>, <code class="language-plaintext highlighter-rouge">getK()</code> sẽ sẽ trả về chuỗi ở vị trí chẳn để làm key, còn chuỗi ở vị trí lẻ sẽ làm IV, sau đó trả về kết quả là base64 và so sánh với y.</p>

<p>Tới đây có vẻ mọi thứ đã rõ ràng, mình dùng script này để decode flag:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">Crypto.Cipher</span> <span class="kn">import</span> <span class="n">AES</span>
<span class="kn">import</span> <span class="nn">base64</span>
<span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">base64</span><span class="p">.</span><span class="n">b64decode</span><span class="p">(</span><span class="sa">b</span><span class="s">'7mePfqpM6Wd1El2sj4dlUboU6PieF7La8IJ1e76cfp4='</span><span class="p">)</span>
<span class="n">k</span> <span class="o">=</span> <span class="sa">b</span><span class="s">"key"</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">base64</span><span class="p">.</span><span class="n">b64decode</span><span class="p">(</span><span class="sa">b</span><span class="s">'Mzg2OTM3NjEzNDc0MzYzMTM1MzUzMjM2MzMzMjMxMzA='</span><span class="p">).</span><span class="n">decode</span><span class="p">()</span>
<span class="n">q</span> <span class="o">=</span> <span class="s">'58504e58564f5d504a59534a58544e59564d5d504a5e524d585c4f5a564f5c57'</span>
<span class="n">getK</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">.</span><span class="n">fromhex</span><span class="p">(</span><span class="n">xor</span><span class="p">(</span><span class="nb">bytes</span><span class="p">.</span><span class="n">fromhex</span><span class="p">(</span><span class="n">q</span><span class="p">),</span><span class="n">k</span><span class="p">).</span><span class="n">decode</span><span class="p">()</span> <span class="o">+</span> <span class="n">x</span><span class="p">)</span>
<span class="n">key</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">iv</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">getK</span><span class="p">)):</span>
    <span class="k">if</span> <span class="n">i</span><span class="o">%</span><span class="mi">2</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">key</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">getK</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">iv</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">getK</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<span class="n">key</span> <span class="o">=</span><span class="nb">bytes</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
<span class="n">iv</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">iv</span><span class="p">)</span>
<span class="n">cipher</span> <span class="o">=</span> <span class="n">AES</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="n">AES</span><span class="p">.</span><span class="n">MODE_CBC</span><span class="p">,</span><span class="n">iv</span><span class="p">[:</span><span class="mi">16</span><span class="p">])</span>
<span class="n">plaintext</span> <span class="o">=</span> <span class="n">cipher</span><span class="p">.</span><span class="n">decrypt</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">plaintext</span><span class="p">)</span>
<span class="c1">#b'ASIS{D3x_iZ_n0t_fOn7!}\n\n\n\n\n\n\n\n\n\n'
</span></code></pre></div></div>
<p>Flag: <code class="language-plaintext highlighter-rouge">ASIS{D3x_iZ_n0t_fOn7!}</code></p>

<p>Bài này làm mình mất thời gian ở chổ phân tích sai class với lại IV và Key  mình đều tính ra là length = 24 cho nên mình nghĩ là sai chổ này, ai ngờ là sai flow chương trình, xem như qua bài này mình cần cẩn thận hơn, tìm hiểu kĩ hơn và bình tĩnh giải quyết.</p>

<h2 id="chaffymasking---crypto">Chaffymasking - Crypto</h2>

<h2 id="description-1">Description</h2>

<p><a href="https://asisctf.com/tasks/chaffymasking_ee328d22852581d833c4792c61b8735ae140d81b.txz">Chaffy masking</a> is a popular cryptography technique that is used to protect cryptographic implementations against several attacks.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nc 65.21.255.31 31377
</code></pre></div></div>

<p>Thử netcat tới server và nhập thử:</p>

<p><img src="https://i.imgur.com/cUmfmuV.png" alt="" /></p>

<p>Xem thử file đề cho:</p>

<p><img src="https://i.imgur.com/WXxpnDz.png" alt="" /></p>

<p>Ta thấy có 1 chổ là flag sẽ xor với <code class="language-plaintext highlighter-rouge">out_1</code> và <code class="language-plaintext highlighter-rouge">out_2</code> sau đó trả về và print ra:</p>

<p>Có nghĩ là để tìm flag ta chỉ cần xor ngược kết quả trả về và <code class="language-plaintext highlighter-rouge">out_1</code> và <code class="language-plaintext highlighter-rouge">out_2</code> và ta phải biết input của mình là gì để có thể lấy được <code class="language-plaintext highlighter-rouge">out_1</code> <code class="language-plaintext highlighter-rouge">out_2</code> trên máy mình.</p>

<p><img src="https://i.imgur.com/qg3hzDg.png" alt="" /></p>

<p>Vậy chổ này đổi thành return <code class="language-plaintext highlighter-rouge">out_1</code>,<code class="language-plaintext highlighter-rouge">out_2</code></p>

<p><img src="https://i.imgur.com/DwlInXi.png" alt="" /></p>

<p>Tới đây chỉ cần lấy output của server rồi xor với <code class="language-plaintext highlighter-rouge">out_1</code>,<code class="language-plaintext highlighter-rouge">out_2</code> là xong</p>

<p><img src="https://i.imgur.com/GSQefld.png" alt="" /></p>

<p><img src="https://i.imgur.com/mn2Cfpl.png" alt="" /></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>

	<span class="n">mask</span> <span class="o">=</span> <span class="s">'2a202f66d560d5831f1a0550f14ed5840e17395dcf5fdca8081c0a59c75fdd98052c0f41f15bd5843400095ac143db98041c095ac143db98042c0354dd75958a'</span>
	<span class="n">mask</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">bytes</span><span class="p">.</span><span class="n">fromhex</span><span class="p">(</span><span class="n">mask</span><span class="p">))</span>
	<span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
	<span class="n">salt</span> <span class="o">=</span> <span class="sa">b</span><span class="s">'a'</span><span class="o">*</span><span class="mi">64</span> <span class="o">+</span> <span class="sa">b</span><span class="s">'b'</span><span class="o">*</span><span class="mi">64</span>
	<span class="n">out1</span> <span class="p">,</span> <span class="n">out2</span> <span class="o">=</span> <span class="n">chaffy_mask</span><span class="p">(</span><span class="n">salt</span><span class="p">,</span><span class="n">main</span><span class="p">(),</span><span class="mi">512</span><span class="p">,</span> <span class="mi">64</span><span class="p">)</span>
	<span class="n">out1</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">out1</span><span class="p">,(</span><span class="mi">64</span><span class="p">,))</span>
	<span class="n">out2</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">out2</span><span class="p">,(</span><span class="mi">64</span><span class="p">,))</span>
	<span class="k">print</span><span class="p">(</span><span class="nb">bytes</span><span class="p">((</span><span class="n">out1</span><span class="o">^</span><span class="n">out2</span><span class="o">^</span><span class="n">mask</span><span class="p">)</span><span class="o">%</span><span class="mi">256</span><span class="p">).</span><span class="n">replace</span><span class="p">(</span><span class="sa">b</span><span class="s">'</span><span class="se">\x00</span><span class="s">'</span><span class="p">,</span><span class="sa">b</span><span class="s">''</span><span class="p">))</span>
    <span class="c1">#ASIS{Lattice_based_hash_collision_it_was_sooooooooooooooo_easY!}
</span></code></pre></div></div>

<p>Flag: <code class="language-plaintext highlighter-rouge">ASIS{Lattice_based_hash_collision_it_was_sooooooooooooooo_easY!}</code></p>

        </div>
    </div>
        <div class="footer">
        c4tbu1 © 2022 <a href="http://localhost:4000/feed.xml" target="_blank"><i class="fa fa-fw fa-feed"></i></a>
    </div>

    <script src="http://localhost:4000/assets/js/jquery-1.12.2.min.js"></script>
<script src="http://localhost:4000/assets/js/jquery.goup.min.js"></script>
<script type="text/javascript">
$(document).ready(function(){
    $.goup({
        trigger: 500,
        bottomOffset: 10,
        locationOffset: 20,
        containerRadius: 0,
        containerColor: '#fff',
        arrowColor: '#000',
        goupSpeed: 'normal'
    });
});
</script>


    <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>
</body>
</html>
